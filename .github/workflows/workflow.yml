# This workflow was automatically generated by tool/generate_workflow.ts
# Please do not edit manually, instead run deno task generate_workflow

name: bench
'on':
  schedule:
    - cron: 0 0 * * *
  push:
    paths:
      - '**.ts'
      - '**.js'
      - '**.tsx'
      - '**.jsx'
      - '**.yml'
      - '**.json'
jobs:
  hello_bench:
    name: 'Hello, bench!'
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3
        with:
          persist-credentials: false
          fetch-depth: 0
      - name: Install Deno
        uses: denoland/setup-deno@v1
      - name: Install Node
        uses: actions/setup-node@v3
      - name: Install Bun
        run: |-
          curl -fsSL https://bun.sh/install | bash
          echo '$HOME/.bun/bin:$PATH' >> $GITHUB_PATH
      - name: Install Autocannon
        run: npm install -g autocannon
      - name: Run Benchmark
        run: deno task benchmark hello_bench
      - name: Save hello_bench results
        id: hello_bench-results
        uses: actions/cache@v3
        with:
          path: frameworks/*/results/hello_bench.json
          key: hello_bench-results
  finish:
    name: Finish
    runs-on: ubuntu-latest
    needs:
      - hello_bench
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3
        with:
          persist-credentials: false
          fetch-depth: 0
      - name: Load hello_bench results
        id: hello_bench-results
        uses: actions/cache@v3
        with:
          path: frameworks/*/results/hello_bench.json
          key: hello_bench-results
      - name: Install Deno
        uses: denoland/setup-deno@v1
      - name: Generate README.md
        run: deno task readme
      - name: Push changes
        uses: actions-js/push@v1
        with:
          github_token: '${{ secrets.GITHUB_TOKEN }}'
          branch: main
